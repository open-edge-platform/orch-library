# SPDX-FileCopyrightText: (C) 2023 Intel Corporation
#
# SPDX-License-Identifier: Apache-2.0
openapi: 3.0.3
info:
  title: Open Policy Agent
  description: A minimal section of the Open Policy Agent API to facilitate 
    code generation.
    Generated by hand from OPA API docs 
    https://github.com/open-policy-agent/opa/blob/main/docs/content/rest-api.md
  version: 0.0.1
paths:
  /v1/data/{package}/{rule}:
    post:
      tags:
        - OpenPolicyAgent
      description: Post a new Query.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OpaInput'
        required: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OpaResponse'
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OpaError'
      parameters:
        - name: package
          in: path
          description: The package of the Rego rule
          required: true
          schema:
            type: string
        - name: rule
          in: path
          description: The rego rule name
          required: true
          schema:
            type: string
        - name: explain
          in: query
          description: Return query explanation in addition to result. Values; notes, fails, full, debug
          schema:
            type: string
        - name: pretty
          in: query
          description: If parameter is true, response will be formatted for humans
          schema:
            type: boolean
        - name: metrics
          in: query
          description: Return query performance metrics in addition to result. See Performance Metrics for more detail
          schema:
            type: boolean
        - name: provenance
          in: query
          description: If parameter is true, response will include build/version info in addition to the result. See Provenance for more detail.
          schema:
            type: boolean
components:
  schemas:
    OpaInput:
      required:
        - input
      type: object
      properties:
        input:
          type: object
          description: the input object
      description: OpenPolicyAgent Input
    OpaResponse:
      required:
        - result
      type: object
      properties:
        result:
          oneOf:
            - type: object
            - type: boolean
          description: The base or virtual document referred to by the URL path. If the
            path is undefined, this key will be omitted.
        metrics:
          type: object
          description: If query metrics are enabled, this field contains query
            performance metrics collected during the parse, compile, and evaluation steps.
        decision_id:
          type: string
          description: If decision logging is enabled, this field contains a string
            that uniquely identifies the decision. The identifier will be included in the
            decision log event for this decision. Callers can use the identifier for
            correlation purpose
      description: API Response
    OpaError:
      type: object
      properties:
        code:
          type: string
          description: Seen in the 400 error
        message:
          type: string
          description: Seen in the 400 error
        error:
          type: string
          description: Seen in the 500 error